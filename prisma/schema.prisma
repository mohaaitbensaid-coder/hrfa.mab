generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User base model
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  fullName      String
  phone         String?
  city          String?
  image         String?
  role          UserRole  @default(CLIENT)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  clientProfile  ClientProfile?
  artisanProfile ArtisanProfile?
}

model ClientProfile {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id])
  addresses   Address[]
  orders      Order[]
  favorites   Favorite[]
}

model ArtisanProfile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id])
  trade           Trade     @relation(fields: [tradeId], references: [id])
  tradeId         String
  bio             String?
  experience      Int?
  isAvailable     Boolean   @default(true)
  rating          Float     @default(0)
  reviewsCount    Int       @default(0)
  portfolio       PortfolioImage[]
  orders          Order[]
  reviews         Review[]
  wallet          Wallet?
}

model Trade {
  id          String    @id @default(uuid())
  nameAr      String
  nameFr      String
  icon        String?
  artisans    ArtisanProfile[]
}

model City {
  id          String    @id @default(uuid())
  nameAr      String
  nameFr      String
}

model Address {
  id              String        @id @default(uuid())
  clientProfileId String
  clientProfile   ClientProfile @relation(fields: [clientProfileId], references: [id])
  street          String
  city            String
  isDefault       Boolean       @default(false)
}

model PortfolioImage {
  id               String         @id @default(uuid())
  artisanProfileId String
  artisanProfile   ArtisanProfile @relation(fields: [artisanProfileId], references: [id])
  url              String
}

model Order {
  id              String      @id @default(uuid())
  clientId        String
  client          ClientProfile @relation(fields: [clientId], references: [id])
  artisanId       String
  artisan         ArtisanProfile @relation(fields: [artisanId], references: [id])
  description     String
  address         String
  scheduledDate   DateTime
  status          OrderStatus @default(PENDING)
  price           Float?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  review          Review?
}

model Review {
  id          String    @id @default(uuid())
  orderId     String    @unique
  order       Order     @relation(fields: [orderId], references: [id])
  artisanId   String
  artisan     ArtisanProfile @relation(fields: [artisanId], references: [id])
  rating      Int
  comment     String?
  createdAt   DateTime  @default(now())
}

model Wallet {
  id               String         @id @default(uuid())
  artisanProfileId String         @unique
  artisanProfile   ArtisanProfile @relation(fields: [artisanProfileId], references: [id])
  balance          Float          @default(0)
  transactions     Transaction[]
}

model Transaction {
  id        String   @id @default(uuid())
  walletId  String
  wallet    Wallet   @relation(fields: [walletId], references: [id])
  amount    Float
  type      String   // DEPOSIT, WITHDRAWAL
  createdAt DateTime @default(now())
}

model Favorite {
  id              String        @id @default(uuid())
  clientProfileId String
  clientProfile   ClientProfile @relation(fields: [clientProfileId], references: [id])
  artisanId       String
  // We can add a relation to ArtisanProfile here if needed
}

enum UserRole {
  CLIENT
  ARTISAN
  ADMIN
}

enum OrderStatus {
  PENDING
  ACCEPTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}
